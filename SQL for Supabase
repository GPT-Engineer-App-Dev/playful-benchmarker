-- Add a new column to the runs table
ALTER TABLE runs
ADD COLUMN total_time_usage INTEGER DEFAULT 0;

-- Create or replace a function to update the total_time_usage
CREATE OR REPLACE FUNCTION update_run_time_usage(
  run_id UUID,
  time_increment INTEGER
)
RETURNS VOID AS $$
BEGIN
  UPDATE runs
  SET total_time_usage = total_time_usage + time_increment
  WHERE id = run_id;
END;
$$ LANGUAGE plpgsql;
-- Create or replace a function to start a run transactionally
CREATE OR REPLACE FUNCTION start_run(
  p_scenario_id UUID,
  p_system_version TEXT,
  p_project_id TEXT,
  p_user_id UUID,
  p_link TEXT
)
RETURNS UUID AS $$
DECLARE
  new_run_id UUID;
BEGIN
  INSERT INTO runs (scenario_id, system_version, project_id, user_id, state, link)
  VALUES (p_scenario_id, p_system_version, p_project_id, p_user_id, 'running', p_link)
  RETURNING id INTO new_run_id;

  RETURN new_run_id;
END;
$$ LANGUAGE plpgsql;
